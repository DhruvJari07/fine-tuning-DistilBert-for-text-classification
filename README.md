# fine-tuning-DistilBert-for-text-classification
Fine tuning pretrained model such as DistilBert for the binary text classification to predict if the text is generated by AI or Human

For Deployement, we can use AWS lambda with API Gateway to serverless deployement.
# Lambda Deployement

Build the image from dockerfile

```
docker build -t <IMAGE_NAME_TAG> .
```

Run the lambda image locally

```
docker run -p 9000:8080 <IMAGE_NAME_TAG>
```

To interact with the container locally, we can send the POST request using curl. Open the bash and apply the following command. Since we are sending text for prediction, we need to sned dict in format of {'text':'YOUR TEXT FOR PREDICTION'}.

```
curl -XPOST "http://localhost:9000/2015-03-31/functions/function/invocations" -d '{'text':'YOUR TEXT FOR PREDICTION'}'
```

you should get the respnse like:

'statusCode': 200,
        'body':          {
                "predicted_label": AI or HUMAN
            }
            
Now, let's deploy to ECR for our lambda function to use this image. apply following commands.

To deploy the Lambda Function with docker image, the first thing we need to do is to upload the image to AWS ECR(Elastic Container Registry). The first thing we need to do is to run the get-login-password command to authenticate the Docker CLI to your Amazon ECR registry.

```
aws ecr get-login-password --region <YOUR_REGION> | docker login --username AWS --password-stdin <YOUR_AWS_ACCOUNT_ID>.dkr.ecr.<YOUR_REGION>.amazonaws.com
```

Then let's create a repository in AWS ECR using the cerate-repository command:

```
aws ecr create-repository --repository-name reco-model --image-scanning-configuration scanOnPush=true --image-tag-mutability MUTABLE
```

Next, Run the docker tag command to tag our local image into our Amazon ECR repository as the latest version:

```
docker tag reco-model:latest <AWS_RepositoryUri>:latest
```

the AWS_RepositoryUri can be found in the response of previous command. Make sure to include :latest at the end of the URI.

Now we can push our local image to the AWS ECR, make sure to include :latest at the end of the URI.:

```
docker push <AWS_RepositoryUri>:latest
```

## Create a lambda function in AWS
Now we need to create a  lambda function in AWS. I have used AWS UI to create this function. Make sure the region is same as ECR region.

Then we will create the new lambda function by selecting container image and selecting our image uploaded to ECR repo. 

Once the lambda function is ready we can test it by creating new test cases.

If there are any changes in the code, you can use the following command only to rebuild the image and connect it with lambda.

```
docker build <AWS_RepositoryUri>:latest .
```

```
docker push <AWS_RepositoryUri>:latest         
```
Then update the lambda function with following command
```
aws lambda update-function-code --function-name <LAMBDA_FUNCTION_NAME> --image-uri <AWS_RepositoryUri>:latest
```

